

# JWT認証とは

## 認証とは
リクエストをしてきている相手がだれであるかを利用者本人かどうかを確認・特定すること

## 認証の有名な方法
1. 知識情報による認証
   - 利用者しか知り得ない情報を入力することで利用者本人を認証する
   **メリット**
   簡単に設定できる最も基本的な認証機能
   **デメリット**
   1. セキュリティレベルがもっとも低い。ハッシュ化などの別途セキュリティ対策が必須となる
   2. リクエストごとに毎回認証を実行しなければならない

2. セッションベース認証
   IDやパスワードを利用して認証を行う。認証ができたらセッションIDを発行して、クッキーにセッションIDの情報を保持させる。
   **メリット**
   1. サーバー側からセッションIDを発行し、そのIDをクッキーに保持させることでログイン認証を一定期間は入力が省略できる
   **デメリット**
   1. 第三者が他人のデバイスを利用されてしまったときに、悪用されてしまうリスクが発生する

3. トークンベース認証
   セッションベース認証のクッキーを利用する代わりに、トークンを利用する認証方法。
   ハードウエアトークンやソフトウエアトークンを利用して短時間のみ利用可能なパスワードを発行する。
   短時間のみ有効なパスワードを発行して、時間内に入力することでログイン認証する仕組み
   **メリット**
   1. セキュリティレベルを高い水準で運用することができる
   2. パスワードが使い捨てになるため、パスワードが漏洩した場合にも再設定が不要。
   3. ユーザーがパスワードの記憶をする必要がない
   **デメリット**
   1. 利用しているデバイスがウイルス感染や第三者が常時盗み見できる状態であれば、成りすましの可能性がある
   2. 使い捨てのパスワードを発行する必要がある

4. ワンタイムパスワード認証
   使い捨てのパスワードをメールやSMSを利用して発行する。そのパスワードを利用して、認証に利用する
   **メリット**
   1. セキュリティレベルを高い水準で運用することができる
   2. パスワードが使い捨てになるため、パスワードが漏洩した場合にも再設定が不要。
   3. ユーザーがパスワードの記憶をする必要がない
   **デメリット**
   1. パスワード発行のシステムにエラーが発生したときに、サービス全体が利用できなくなってしまう可能性がある

5. OAuth






6. 生体認証
   - 顔認証や指紋・声紋認証による利用者本人を認証する
   - 運転免許書など顔写真証明書による認証する
   - パソコンやスマートフォンなどの生体情報を利用した認証
   **メリット**
   1. 他人による成りすましや盗用が非常に困難なためセキュリティレベルが高い
   2. 利便性の向上。認証に伴うクライアント側の処理が手軽である
   **デメリット**
   3. 知識情報以上の個人情報となるため、機密性の高い情報管理が必要となる
   4. 認証制度のばらつき。クライアント側のデバイスの認証制度に影響を受ける
   5. コストが高くなる。生体認証システムを導入するための、機材やシステムの導入にコストが発生する



## JWTとは
- JSON Web Token(JWT)
- JWTは,HTTPヘッダーやクエリパラメータに載せられるように
  1. JSONデータをURLセーフする方法を規定したもの => JSONデータをBASE64URLエンコードする
  2. JSONデータをコンパクトにする方法を規定したもの => よく使用されるデータ項目を略称にして、JSONキーを短くするこれによってJSONデータをコンパクトにする
    省略形の一例
    省略名	項目名	説明
    iss |	issuer         |	JWTの発行者
    sub |	subject        |	ユーザの識別子などJWTの主体
    aud |	audience       |	JWTの受信者
    exp |	expiration time|	JWTの有効期限
    nbf |	Not Before     |	JWTの有効開始日時
    iat |	Issued At      |	JWTの発行日時
    jti |	JWT ID         |	JWTの一意な識別子
    JWTではJSONのデータ項目(キーと値のペア)をClaim(クレーム)と呼ぶ
    このようにクレームとして定義された情報をエンコードしてデータを小さくして、HTTPヘッダーやクエリパラメータに載せられるようにします。

## JWSとは
    JWTはBASE64URLエンコードされているだけなため、セキュリティ面ではなにも担保されていない
    BASE64URLデコードすればすぐにもとのデータ形式に戻すことができるし、改ざんも可能
    この改ざんを防止(改ざんを検知する仕組み)する手段がJWS
    JWSは改ざん自体を防ぐものではなく、改ざんされたJWSどうかを検知することができる
    JWSの仕組み
    1. HTTPヘッダーとペイロード(ヘッダーに載せたいデータ)をBASE64URLでエンコードする
    2. 1のエンコードしたものを.でくっつける
    3. 2の結果を暗号鍵とヘッダーのalgに指定された方式で暗号化して、BASE64URLでエンコードする
    4. 2と3の結果を.でくっつける
    5. エンコードされたヘッダー.エンコードされたペイロード.エンコードされた暗号鍵とヘッダーのalgに応じて暗号化された前二つの情報(トークン)

## JWSの検証
    JWSの仕組み上、前の二つの情報はBASE64URlでエンコードされているだけなため、情報を確認することは簡単
    改ざん自体も可能。しかし３番目の情報に関しては不可能

    - 暗号鍵は信頼している相手しか持っていない
    - 暗号化した内容は同じ暗号鍵を持っていなければ復号化できる
    上記の２点から信頼した相手からのJWSであれば、復号化した情報が内容が改ざんされていないことになる

## JWTによる認証
